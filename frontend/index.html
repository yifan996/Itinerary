<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªæ€§åŒ–æ—…è¡ŒåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>  <!--å¼•å…¥Tailwind CSSæ¡†æ¶-->
    <script src="https://cdn.jsdelivr.net/npm/marked@2.1.3/lib/marked.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">  <!--å¼•å…¥font-awesomeçŸ¢é‡å›¾æ ‡åº“-->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">  <!--å¼•å…¥ Google Fonts ä¸­çš„ Inter å­—ä½“-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>  <!--å¼•å…¥ Vue.js å‰ç«¯æ¡†æ¶çš„ CDN æ–‡ä»¶-->
    <script src="https://cdn.jsdelivr.net/npm/axios@0.24.0/dist/axios.min.js"></script><!--å¼•å…¥Axiosç”¨äºå‘é€ HTTP è¯·æ±‚ï¼Œä¸åç«¯é€šä¿¡-->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B35',
                        secondary: '#F7931E',
                        accent: '#FFD23F',
                        'gray-pink': '#F8F4F7',
                        'neutral-dark': '#E8E8E8',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-soft': 'pulse 2s infinite',
                        'float': 'float 5s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(15px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(25px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-8px)' }
                        }
                    }
                }
            }
        }
   </script>
<style type="text/tailwindcss">
    @layer utilities {
        .content-auto { content-visibility: auto; }
        .gradient-text {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 50%, #FFD23F 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .custom-slider {
            appearance: none;
            height: 8px;
            background: #E8E8E8;
            border-radius: 4px;
            outline: none;
            transition: all 0.2s ease;
        }
        .custom-slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid #333;
            background: #FFF;
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .custom-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .left-panel { background: linear-gradient(145deg, #F8F4F7 0%, #F0E6EF 100%); box-shadow: inset 0 0 20px rgba(248, 244, 247, 0.5); }
        .right-panel { background: linear-gradient(145deg, #FFFFFF 0%, #FDFDFD 100%); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .generate-button {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        .generate-button:hover { box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4); transform: translateY(-2px); }
        .chat-input {
            background: #FFFFFF;
            border: 2px solid #E8E8E8;
            border-radius: 24px;
            transition: all 0.3s ease;
        }
        .chat-input:focus {
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            outline: none;
        }
        .personality-input {
            background: #FFFFFF;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .personality-input:focus {
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            outline: none;
        }
        .chat-message { max-width: 80%; word-wrap: break-word; padding: 12px 18px; border-radius: 18px; margin-bottom: 8px; }
        .user-message { background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%); color: white; border-radius: 18px 18px 4px 18px; margin-left: auto; }
        .ai-message { background: #F8F9FA; color: #333; border-radius: 18px 18px 18px 4px; border: 1px solid #E9ECEF; margin-right: auto; }
        .typing-indicator { display: inline-flex; align-items: center; gap: 4px; }
        .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: #666; animation: bounce 1.4s infinite both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    }
    
    /* è¡Œç¨‹å†…å®¹æ»šåŠ¨å®¹å™¨ï¼ˆæ”¾åœ¨@layer utilitieså¤–é¢ï¼‰ */
    .itinerary-content-container {
        height: 100%;
  max-height: none;
  overflow-y: auto;
  min-height: 0;
    }
    
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .itinerary-content-container::-webkit-scrollbar {
        width: 8px !important;
    }
    
    .itinerary-content-container::-webkit-scrollbar-track {
        background: #f1f1f1 !important;
        border-radius: 4px !important;
        margin: 4px 0 !important;
    }
    
    .itinerary-content-container::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%) !important;
        border-radius: 4px !important;
        border: 2px solid #f1f1f1 !important;
    }
    
    .itinerary-content-container::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #F7931E 0%, #FF6B35 100%) !important;
    }
    
    /* Firefoxæ»šåŠ¨æ¡æ ·å¼ */
    .itinerary-content-container {
        scrollbar-width: thin !important;
        scrollbar-color: #FF6B35 #f1f1f1 !important;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-height: 800px) {
        .itinerary-content-container {
            max-height: 400px !important;
        }
    }
    
    @media (max-height: 600px) {
        .itinerary-content-container {
            max-height: 300px !important;
        }
    }
    
    /* ç¡®ä¿è¡Œç¨‹å†…å®¹ä¸è¢«éšè— */
    #itinerary-display-container {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
        position: relative !important;
    }
    
    #itinerary-display-container * {
        opacity: 1 !important;
        visibility: visible !important;
        color: #333 !important;
    }
    
    /* ç¡®ä¿h1-h3æ ‡ç­¾å¯è§ */
    #itinerary-display-container h1,
    #itinerary-display-container h2,
    #itinerary-display-container h3 {
        color: #333 !important;
    }
    
    /* ç¡®ä¿åˆ—è¡¨å¯è§ */
    #itinerary-display-container ul,
    #itinerary-display-container li {
        margin-bottom: 0.5em !important;
    }
</style>
</head>
<body class="font-inter">
    <div id="app">
        <!-- Header -->
        <header class="relative overflow-hidden bg-white shadow-sm">
            <div class="absolute inset-0 bg-gradient-to-r from-primary/5 to-secondary/10"></div>
            <div class="relative container mx-auto px-6 py-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4 animate-fade-in">
                        <div class="w-14 h-14 bg-gradient-to-br from-primary to-secondary rounded-2xl flex items-center justify-center shadow-xl animate-float">
                            <i class="fa fa-compass text-white text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">ä¸ªæ€§åŒ–æ—…è¡ŒåŠ©æ‰‹</h1>
                            <p class="text-gray-600">è®©è¡Œç¨‹æ¨èè´´åˆä½ çš„ç‹¬ç‰¹é£æ ¼</p>
                        </div>
                    </div>
                    <div class="hidden md:flex items-center space-x-6 animate-slide-up">
                        <button class="text-gray-600 hover:text-primary transition-colors duration-300 font-medium">
                            <i class="fa fa-question-circle mr-2"></i>å¸®åŠ©
                        </button>
                        <button class="text-gray-600 hover:text-primary transition-colors duration-300 font-medium" @click="getHistory">
                            <i class="fa fa-history mr-2"></i>å†å²è®°å½•
                        </button>
                        <button class="bg-gradient-to-r from-primary to-secondary text-white px-8 py-3 rounded-xl font-semibold hover:from-secondary hover:to-primary transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105" @click="saveProfile">
                            <i class="fa fa-save mr-2"></i>ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Session 1: Big Five Test (BFI-10) -->
<main v-if="session === 'bfi10'" class="container mx-auto px-6 py-12">
  <div class="max-w-3xl mx-auto right-panel rounded-3xl p-8 animate-slide-up">
    <h2 class="text-3xl font-bold gradient-text mb-2">å¤§äº”äººæ ¼æµ‹è¯•</h2>
    <p class="text-gray-600 mb-8">
      ä¸ºäº†æ›´å¥½çš„è·å–ä¸ªæ€§åŒ–æ—…è¡Œè§„åˆ’ï¼Œè¯·è®©æˆ‘ä»¬ç”¨1åˆ†é’Ÿæ—¶é—´äº†è§£ä½ ï½
    </p>

    <div class="space-y-6">
      <div v-for="(item, idx) in bfi10.items"
           :key="item.id"
           class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
        <div class="flex items-start justify-between gap-4 mb-4">
          <div class="font-semibold text-gray-900">
            Q{{ item.id }}. {{ item.text }}
          </div>
          <div class="text-sm text-gray-500">
            ç¨‹åº¦æ‰“åˆ†: {{ bfi10.answers[idx] }} <span v-if="bfi10.touched[idx]">âœ…</span>
          </div>
        </div>

        <div class="flex justify-between text-sm text-gray-600 mb-2">
          <span>éå¸¸ä¸åŒæ„ (1)</span>
          <span>éå¸¸åŒæ„ (5)</span>
        </div>

        <input type="range"
               min="1" max="5" step="1"
               class="w-full custom-slider"
               v-model.number="bfi10.answers[idx]"
               @input="onBfi10Input(idx)">
      </div>
    </div>

    <button class="mt-8 w-full generate-button text-white py-4 px-6 rounded-lg font-bold text-lg"
            :disabled="!bfi10Complete"
            :class="!bfi10Complete ? 'opacity-50 cursor-not-allowed' : ''"
            @click="finishBfi10">
      å®Œæˆ ({{ bfi10AnsweredCount }}/10)
    </button>

    <p v-if="!bfi10Complete" class="mt-3 text-sm text-gray-600">
      è¯·è‡³å°‘ç§»åŠ¨æ¯ä¸ªæ»‘å—ä¸€æ¬¡ä»¥å®Œæˆæµ‹è¯•ã€‚
    </p>
  </div>
</main>

        <!-- Main Content -->
        <main v-else-if="session === 'main'" class="container mx-auto px-6 py-12">
            <div class="grid lg:grid-cols-10 gap-8">
                <!-- Left Panel: Preferences  -->
                <div class="lg:col-span-3 space-y-6">
                    <div class="left-panel rounded-3xl p-8 space-y-6 animate-fade-in">
                        <!-- å¤§æ ‡é¢˜ï¼šPreference -->
                        <h2 class="text-3xl font-bold gradient-text mb-6 flex items-center">
                            <i class="fa fa-sliders text-primary mr-3 text-xl"></i>
                            åå¥½
                        </h2>

                        <!-- ç¬¬ä¸€è¡Œï¼šTrip Duration (Days) -->
                        <div class="space-y-3">
                            <label class="block text-base font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-calendar text-primary mr-3"></i>
                                æƒ³è¦æ—…è¡Œå¤šå°‘å¤©ï¼Ÿ
                            </label>
                            <div class="relative">
                                <input type="number" 
                                       v-model.number="formData.days"
                                       min="1" 
                                       max="30" 
                                       class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-3 focus:ring-primary/20 focus:border-primary transition-all duration-300 shadow-sm hover:shadow-md text-base bg-white">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                    <i class="fa fa-calendar-days text-lg"></i>
                                </div>
                            </div>
                        </div>

                        <!-- åˆ†ç•Œçº¿ -->
                        <div class="w-full h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent my-4"></div>

                        <!-- Travel Preference å°æ ‡é¢˜ -->
                        <div class="space-y-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-heart text-primary mr-3"></i>
                                æ›´å–œæ¬¢...
                            </h3>
                            
                            <!-- æ»‘æ†1: Spontaneity vs Planning -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">è®¡åˆ’</span>
                                    <span class="text-sm font-medium text-gray-700">éšæ€§</span>
                                </div>
                                <input type="range" 
                                       v-model.number="formData.spontaneity"
                                       min="0" 
                                       max="1" 
                                       step="0.1" 
                                       class="w-full custom-slider">
                                <div class="text-center">
                                    <span class="inline-block px-3 py-1 bg-white text-gray-800 font-semibold rounded-lg text-base shadow-sm border border-gray-200">{{ formData.spontaneity.toFixed(1) }}</span>
                                </div>
                            </div>

                            <!-- æ»‘æ†2: Novelty vs Familiarity -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">ç†Ÿæ‚‰æ„Ÿ</span>
                                    <span class="text-sm font-medium text-gray-700">æ–°é²œæ„Ÿ</span>
                                </div>
                                <input type="range" 
                                       v-model.number="formData.novelty"
                                       min="0" 
                                       max="1" 
                                       step="0.1" 
                                       class="w-full custom-slider">
                                <div class="text-center">
                                    <span class="inline-block px-3 py-1 bg-white text-gray-800 font-semibold rounded-lg text-base shadow-sm border border-gray-200">{{ formData.novelty.toFixed(1) }}</span>
                                </div>
                            </div>

                            <!-- æ»‘æ†3: Hedonic Enjoyment vs Meaningful Enrichment -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">æ„ä¹‰æ”¶è·</span>
                                    <span class="text-sm font-medium text-gray-700">å³æ—¶äº«ä¹</span>
                                </div>
                                <input type="range" 
                                       v-model.number="formData.hedonic"
                                       min="0" 
                                       max="1" 
                                       step="0.1" 
                                       class="w-full custom-slider">
                                <div class="text-center">
                                    <span class="inline-block px-3 py-1 bg-white text-gray-800 font-semibold rounded-lg text-base shadow-sm border border-gray-200">{{ formData.hedonic.toFixed(1) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- åˆ†ç•Œçº¿ -->
                        <div class="w-full h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent my-4"></div>

                        <!-- Your Recent Status å°æ ‡é¢˜ -->
                        <div class="space-y-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-bolt text-primary mr-3"></i>
                                ä½ æœ€è¿‘çš„çŠ¶æ€
                            </h3>
                            
                            <!-- æ»‘æ†4: Tired vs Energetic -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">ç²¾åŠ›å……æ²›</span>
                                    <span class="text-sm font-medium text-gray-700">æ„Ÿåˆ°ç–²æƒ«</span>
                                </div>
                                <input type="range" 
                                       v-model.number="formData.tired"
                                       min="0" 
                                       max="1" 
                                       step="0.1" 
                                       class="w-full custom-slider">
                                <div class="text-center">
                                    <span class="inline-block px-3 py-1 bg-white text-gray-800 font-semibold rounded-lg text-base shadow-sm border border-gray-200">{{ formData.tired.toFixed(1) }}</span>
                                </div>
                            </div>

                            <!-- æ»‘æ†5: Anxious vs Relaxed -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">å¿ƒæƒ…æ”¾æ¾</span>
                                    <span class="text-sm font-medium text-gray-700">ç„¦è™‘</span>
                                </div>
                                <input type="range" 
                                       v-model.number="formData.anxious"
                                       min="0" 
                                       max="1" 
                                       step="0.1" 
                                       class="w-full custom-slider">
                                <div class="text-center">
                                    <span class="inline-block px-3 py-1 bg-white text-gray-800 font-semibold rounded-lg text-base shadow-sm border border-gray-200">{{ formData.anxious.toFixed(1) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- åˆ†ç•Œçº¿ -->
                        <div class="w-full h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent my-4"></div>

                        <!-- Personality (Optional) å°æ ‡é¢˜ -->
                        <div id="personality-section" class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-user-circle text-primary mr-3"></i>
                                äººæ ¼ç‰¹è´¨æµ‹è¯•ç»“æœ
                            </h3>
                            
                            <!-- å¦‚æœæƒ³è¦é‡åšæµ‹è¯• -->
                            <button type="button"
  class="block w-full text-center py-3 bg-white text-primary hover:bg-gray-50 transition-all duration-300 text-base font-semibold rounded-xl border border-primary/30 hover:border-primary/50 shadow-sm"
  @click="session='bfi10'"
>
  â†’ é‡æ–°è¿›è¡Œå¤§äº”äººæ ¼æµ‹è¯•
</button>


                            <!-- 5ä¸ªè¾“å…¥æ¡†: Openness, Conscientiousness, Extraversion, Agreeableness, Neuroticism -->
                            <div class="grid grid-cols-1 gap-3">
                                <div class="space-y-1">
                                    <label class="text-sm font-medium text-gray-700">å¼€æ”¾æ€§:</label>
                                    <input type="number" 
                                           v-model.number="personality.openness"
                                           min="0" 
                                           max="1" 
                                           step="0.1"
                                           placeholder="0.0-1.0" 
                                           class="personality-input w-full px-3 py-2 text-sm bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-sm font-medium text-gray-700">å°½è´£æ€§:</label>
                                    <input type="number" 
                                           v-model.number="personality.conscientiousness"
                                           min="0" 
                                           max="1" 
                                           step="0.1"
                                           placeholder="0.0-1.0" 
                                           class="personality-input w-full px-3 py-2 text-sm bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-sm font-medium text-gray-700">å¤–å‘æ€§:</label>
                                    <input type="number" 
                                           v-model.number="personality.extraversion"
                                           min="0" 
                                           max="1" 
                                           step="0.1"
                                           placeholder="0.0-1.0" 
                                           class="personality-input w-full px-3 py-2 text-sm bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-sm font-medium text-gray-700">å®œäººæ€§:</label>
                                    <input type="number" 
                                           v-model.number="personality.agreeableness"
                                           min="0" 
                                           max="1" 
                                           step="0.1"
                                           placeholder="0.0-1.0" 
                                           class="personality-input w-full px-3 py-2 text-sm bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-sm font-medium text-gray-700">ç¥ç»è´¨:</label>
                                    <input type="number" 
                                           v-model.number="personality.neuroticism"
                                           min="0" 
                                           max="1" 
                                           step="0.1"
                                           placeholder="0.0-1.0" 
                                           class="personality-input w-full px-3 py-2 text-sm bg-white">
                                </div>
                            </div>
                            
                            <!-- Input Guide -->
                            <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded-lg">
                                <i class="fa fa-info-circle mr-1"></i>
                                è¾“å…¥0-1ä¹‹é—´çš„å€¼
                            </div>
                        </div>

                        <!-- Generate Itenery æŒ‰é’® -->
                        <button @click="generateItinerary"
                                :disabled="isGenerating"
                                class="w-full generate-button text-white py-4 px-6 rounded-lg font-bold text-lg focus:outline-none focus:ring-4 focus:ring-primary/30 mt-4">
                            <i v-if="isGenerating" class="fa fa-spinner fa-spin mr-3"></i>
                            <i v-else class="fa fa-magic mr-3"></i>
                            <span v-if="isGenerating">ç”Ÿæˆä¸­...</span>
                            <span v-else>ç”Ÿæˆè¡Œç¨‹</span>
                        </button>
                    </div>
                </div>

                <!-- Right Panel: Itinerary -->
                <div class="lg:col-span-7">
                    <div class="right-panel rounded-3xl p-8 animate-slide-up flex flex-col h-[calc(100vh-0px)] overflow-hidden">
                        <!-- æ ‡é¢˜ï¼šItinerary -->
                        <h2 class="text-3xl font-bold gradient-text mb-8 flex items-center">
                            <i class="fa fa-map text-primary mr-3 text-xl"></i>
                            å®šåˆ¶è¡Œç¨‹
                        </h2>
                        <div class="flex-1 min-h-0 overflow-hidden flex flex-col">

                        <!-- Loading State -->
<div v-if="isLoading"
     class="text-center py-20 flex-1 flex flex-col justify-center items-center">
  <div class="animate-spin rounded-full h-20 w-20 border-4 border-primary/30 border-t-primary mb-6"></div>
  <p class="text-xl text-gray-700 font-medium mb-2">æ­£åœ¨å®šåˆ¶ä¸“å±è¡Œç¨‹â€¦</p>
  <p class="text-gray-500">å—ç»è´¹é™åˆ¶ï¼Œé€Ÿåº¦æœ‰ç‚¹æ…¢ğŸ˜¢ï¼Œéå¸¸æ„Ÿè°¢æ‚¨çš„è€å¿ƒå’Œæ”¯æŒï¼</p>
</div>


                        <!-- Empty State -->
                        <div v-else-if="!itineraryData && !historyData" class="text-center py-20 flex-1 flex flex-col justify-center">
                            <div class="w-32 h-32 bg-gradient-to-br from-primary/15 to-secondary/15 rounded-full flex items-center justify-center mx-auto mb-8">
                                <i class="fa fa-compass text-primary text-4xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">ä½ çš„æ—…è¡Œï¼Œä»è¿™é‡Œå¼€å§‹</h3>
                            <p class="text-gray-600 text-lg mb-8 max-w-2xl mx-auto">
                                è°ƒæ•´ä½ çš„åå¥½ï¼Œè®©ç³»ç»Ÿä¸ºä½ ç”Ÿæˆå¥‘åˆä½ äººæ ¼ä¸æ—…è¡Œé£æ ¼çš„è¡Œç¨‹ã€‚
                            </p>
                            <div class="w-full max-w-md mx-auto rounded-2xl shadow-xl overflow-hidden">
                                <div class="bg-gradient-to-r from-primary to-secondary p-6 text-white text-center">
                                    <h4 class="font-bold text-lg mb-2">å¦‚ä½•ä½¿ç”¨</h4>
                                    <ol class="text-sm space-y-1 text-left">
                                        <li>1. è®¾ç½®ä½ çš„æ—…è¡Œåå¥½å’Œæ€§æ ¼ç‰¹å¾</li>
                                        <li>2. ç‚¹å‡»â€œç”Ÿæˆè¡Œç¨‹â€æŒ‰é’®</li>
                                        <li>3. ç¨å€™ç‰‡åˆ»ï¼Œç³»ç»Ÿä¼šä¸ºä½ è§„åˆ’ä¸“å±è¡Œç¨‹</li>
                                        <li>4. æŸ¥çœ‹è¡Œç¨‹ï¼Œå¹¶ä¸æ™ºèƒ½åŠ©æ‰‹è¿›è¡Œäº¤æµ</li>
                                    </ol>
                                </div>
                            </div>
                        </div>

                        <!-- History Data -->
                        <!--æ˜¾ç¤ºç”¨æˆ·çš„å†å²æ—…è¡Œæ•°æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªè¡Œç¨‹æä¾›è¯¦ç»†ä¿¡æ¯å’ŒæŸ¥çœ‹åŠŸèƒ½-->
                        <div v-else-if="historyData && !itineraryData" class="flex-1 min-h-0 overflow-y-auto pr-4">
                            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                                <i class="fa fa-history text-primary mr-3"></i>
                                Your Travel History ({{ historyData.length }})
                            </h3>
                            <div class="space-y-6">
                                <div v-for="(item, index) in historyData" :key="item._id" class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-lg font-bold text-gray-900">
                                            {{ item.tripType }} Trip ({{ item.days }} Days)
                                        </h4>
                                        <span class="text-sm text-gray-500">{{ new Date(item.createdAt).toLocaleString() }}</span>
                                    </div>
                                    <div class="grid md:grid-cols-3 gap-4 mb-4">
                                        <div class="bg-gray-50 rounded-lg p-3 text-center">
                                            <div class="text-sm text-gray-500">Activities</div>
                                            <div class="text-xl font-bold text-primary">{{ item.totalActivities }}</div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-3 text-center">
                                            <div class="text-sm text-gray-500">Personality Match</div>
                                            <div class="text-xl font-bold text-purple-600">{{ item.matchPercentage }}%</div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-3 text-center">
                                            <div class="text-sm text-gray-500">Status</div>
                                            <div class="text-xl font-bold text-green-600">Completed</div>
                                        </div>
                                    </div>
                                    <button @click="loadHistoryItem(item)" class="w-full bg-primary/10 text-primary py-2 rounded-lg font-semibold hover:bg-primary/20 transition-colors duration-300">
                                        å±•ç¤ºç»†èŠ‚
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- API Error State -->
                        <div v-else-if="apiError" class="text-center py-20 flex-1 flex flex-col justify-center">
                            <div class="w-32 h-32 bg-gradient-to-br from-red-15 to-red-15 rounded-full flex items-center justify-center mx-auto mb-8">
                                <i class="fa fa-exclamation-triangle text-red-500 text-4xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-red-600 mb-4">API Call Failed</h3>
                            <p class="text-gray-600 text-lg mb-4 max-w-2xl mx-auto">
                                {{ apiError }}
                            </p>
                            <p class="text-gray-500 mb-6">è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚</p>
                            <button @click="generateItinerary" class="bg-primary text-white px-8 py-3 rounded-xl font-semibold hover:bg-secondary transition-all duration-300">
                                <i class="fa fa-refresh mr-2"></i>
                                é‡è¯•
                            </button>
                        </div>

    <!-- Itinerary Results -->
  <div v-if="itineraryData" class="flex-1 min-h-0 overflow-hidden flex flex-col">
    <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-8 border border-primary/20 mb-8 flex-1 min-h-0 flex flex-col">
      
      <div class="flex items-center justify-between mb-6 shrink-0">
        <h3 class="text-xl font-bold text-gray-900">è¡Œç¨‹æ€»è§ˆ</h3>
        <button @click="copyItinerary" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors">
          <i class="fa fa-copy mr-2"></i>å¤åˆ¶
        </button>
        <button @click="goToSurvey"
        class="bg-white border border-primary/40 text-primary px-4 py-2 rounded-lg hover:bg-primary/10 transition-colors">
  <i class="fa fa-list-alt mr-2"></i>å¡«å†™é—®å·
</button>

      </div>

      <!-- çœŸæ­£æ»šåŠ¨çš„åŒºåŸŸï¼šå¿…é¡» flex-1 min-h-0 overflow-y-auto -->
      <!-- å·¦ä¾§å›ºå®šç´¢å¼• + å³ä¾§æ»šåŠ¨å†…å®¹ -->
<div class="flex-1 min-h-0 flex gap-4">

  <!-- å·¦ä¾§ï¼šç´¢å¼•ï¼ˆå›ºå®šä¸æ»šåŠ¨ï¼‰ -->
  <aside v-if="dayIndex.length" class="w-28 shrink-0">
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-3">
      <div class="text-xs font-semibold text-gray-500 mb-2">æ—¥æœŸ</div>

      <div class="space-y-1">
        <button
          v-for="d in dayIndex"
          :key="d.id"
          @click="scrollToDay(d.id)"
          class="w-full text-left px-2 py-2 rounded-lg text-sm font-semibold hover:bg-primary/10 hover:text-primary transition"
        >
          {{ d.label }}
        </button>
      </div>
    </div>
  </aside>

  <!-- å³ä¾§ï¼šåªæœ‰è¿™ä¸€åˆ—ä¸Šä¸‹æ»šåŠ¨ -->
  <div ref="itineraryScroll" class="flex-1 min-h-0 overflow-y-auto pr-2">
    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
      <div class="prose max-w-none">
        <div id="itinerary-display-container" v-html="itineraryData"></div>
      </div>
    </div>
  </div>

</div>

      </div>

    </div>
  </div>
</div>

                        <!-- Chat Interface -->
                        <div class="mt-4 border-t border-gray-200 pt-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fa fa-comments text-primary mr-2"></i>
                                ä¸AIåŠ©æ‰‹èŠå¤©
                            </h3>
                            
                            <!-- Chat Messages -->
                            <div class="space-y-4 mb-4 max-h-40 overflow-y-auto pr-2" id="chatMessages">
                                <div v-for="message in chatMessages" :key="message._id || message.id" class="flex items-start space-x-3">
                                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0" :class="message.sender === 'user' ? 'bg-gray-600' : 'bg-primary'">
                                        <i :class="message.sender === 'user' ? 'fa fa-user' : 'fa fa-robot'"></i>
                                    </div>
                                    <div class="chat-message" :class="message.sender === 'user' ? 'user-message' : 'ai-message'">
                                        <p class="text-sm" v-html="message.message"></p>
                                    </div>
                                </div>
                                
                                <!-- Typing Indicator -->
                                <div v-if="isTyping" class="flex items-start space-x-3">
                                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0">
                                        <i class="fa fa-robot"></i>
                                    </div>
                                    <div class="chat-message ai-message p-4">
                                        <div class="typing-indicator">
                                            <div class="typing-dot"></div>
                                            <div class="typing-dot"></div>
                                            <div class="typing-dot"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Chat Input -->
                            <div class="relative">
                                <input type="text" 
                                       v-model="chatInput"
                                       @keypress="handleChatKeyPress"
                                       placeholder="è¯¢é—®æˆ‘å…³äºè¡Œç¨‹çš„ä»»ä½•é—®é¢˜â€¦" 
                                       class="chat-input w-full px-6 py-4 pl-12 text-gray-700 text-lg">
                                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                    <i class="fa fa-comment text-xl"></i>
                                </div>
                                <button @click="sendChatMessage" class="absolute right-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white hover:bg-secondary transition-colors duration-300">
                                    <i class="fa fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
           
        </main>

<!-- Survey -->
<main v-else-if="session === 'survey'" class="container mx-auto px-6 py-12">
  <div class="max-w-3xl mx-auto right-panel rounded-3xl p-8 animate-slide-up">
    <h2 class="text-3xl font-bold gradient-text mb-2">é—®å·</h2>
    <p class="text-gray-600 mb-8">è¯·æ ¹æ®åˆšåˆšç”Ÿæˆçš„è¡Œç¨‹å¡«å†™ã€‚</p>

<div class="space-y-6">

  <!-- ç»Ÿä¸€è¯´æ˜ -->
  <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
    <div class="font-semibold text-gray-900 mb-2">è¯´æ˜</div>
    <div class="text-sm text-gray-600 leading-relaxed">
      è¯·æ ¹æ®æ‚¨çš„å®é™…æ„Ÿå—ï¼Œé€‰æ‹©æ‚¨å¯¹ä»¥ä¸‹é™ˆè¿°çš„åŒæ„ç¨‹åº¦ã€‚
    </div>
  </div>

  <!-- 14 Likert Questions -->
  <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm"
       v-for="item in surveyQuestions"
       :key="item.k">

    <div class="font-semibold text-gray-900 mb-3">
      {{ item.no }}. {{ item.text }}
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-5 gap-2">
      <label v-for="(t, i) in likertOptions"
             :key="item.k + '_' + i"
             class="flex items-center gap-2 text-sm bg-gray-50 rounded-lg px-3 py-2 border border-gray-200 hover:border-primary/40">
        <input type="radio" :value="i+1" v-model.number="survey[item.k]">
        <span>{{ t }}</span>
      </label>
    </div>

    <p v-if="survey[item.k] === null" class="text-xs text-gray-400 mt-2">
      è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ã€‚
    </p>
  </div>

</div>


    <!-- æ“ä½œæŒ‰é’® -->
    <div class="flex gap-3 mt-8">
      <button class="w-1/3 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200"
              :disabled="surveySubmitting"
              @click="backToMainFromSurvey">
        è¿”å›
      </button>

      <button class="w-2/3 generate-button text-white py-3 rounded-xl font-bold"
              :disabled="surveySubmitting"
              @click="submitSurvey">
        <i v-if="surveySubmitting" class="fa fa-spinner fa-spin mr-2"></i>
        æäº¤é—®å·
      </button>
    </div>

    <p class="text-xs text-gray-500 mt-3">
      æäº¤åä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼Œå¹¶è¿”å›åˆ°å®Œæˆé¡µé¢ã€‚
    </p>
  </div>
</main>

<!-- Survey Done -->
<main v-else-if="session === 'survey_done'" class="container mx-auto px-6 py-12">
  <div class="max-w-3xl mx-auto right-panel rounded-3xl p-8 animate-slide-up text-center">
    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center">
      <i class="fa fa-check text-green-600 text-3xl"></i>
    </div>

    <h2 class="text-3xl font-bold gradient-text mb-2">é—®å·æäº¤æˆåŠŸ</h2>
    <p class="text-gray-600 mb-8">è°¢è°¢ï¼ä½ çš„åé¦ˆå·²ç»ä¿å­˜ã€‚</p>

    <div class="flex gap-3 justify-center">
      <button
        class="bg-gray-100 text-gray-700 py-3 px-6 rounded-xl font-semibold hover:bg-gray-200"
        @click="backToMainAfterSurvey"
      >
        è¿”å›è¡Œç¨‹é¡µ
      </button>

      <button
        class="generate-button text-white py-3 px-6 rounded-xl font-bold"
        @click="startNewTrip"
      >
        å†ç”Ÿæˆä¸€ä¸ªè¡Œç¨‹
      </button>
    </div>
  </div>
</main>


<!-- Footer -->
<footer class="mt-20 bg-gray-900 text-white py-16">
  <!-- ä¸ŠåŠéƒ¨åˆ†ï¼šåªä¿ç•™ä¸€æ ï¼ˆå— container çº¦æŸï¼‰ -->
  <div class="container mx-auto px-6">
    <div class="space-y-4">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-xl flex items-center justify-center">
          <i class="fa fa-compass text-white"></i>
        </div>
        <span class="font-bold text-xl">ä¸ªæ€§åŒ–æ—…è¡ŒåŠ©æ‰‹</span>
      </div>
      <p class="text-gray-400">ä¸ºæ¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ä½ ï¼Œæ‰“é€ ä¸“å±è¡Œç¨‹è§„åˆ’ã€‚</p>
    </div>
  </div>

  <!-- ä¸‹åŠéƒ¨åˆ†ï¼šå…¨å®½åº•æ ï¼ˆä¸å— container é™åˆ¶ï¼‰ -->
  <div class="border-t border-gray-800 mt-12">
    <div class="px-6 pt-8 text-center text-gray-400">
      <p class="md:whitespace-nowrap">
        &copy; Adaptive Travel Assistant
        <span class="hidden md:inline"> | </span>
        <span class="block md:inline">All rights reserved</span>
      </p>
    </div>
  </div>
</footer>



        <!-- Mobile Menu Button -->
        <button class="md:hidden fixed top-6 right-6 z-50 w-12 h-12 bg-white rounded-2xl shadow-lg flex items-center justify-center text-gray-700 hover:text-primary transition-all duration-300">
            <i class="fa fa-bars text-xl"></i>
        </button>
    </div>

    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    likertOptions: [
  'éå¸¸ä¸åŒæ„',
  'ä¸åŒæ„',
  'ä¸­ç«‹',
  'åŒæ„',
  'éå¸¸åŒæ„'
],

surveyQuestions: [
  { no: 1,  k: 'q1',  text: 'ç³»ç»Ÿæ¨èçš„æ—…è¡Œè¡Œç¨‹ç¬¦åˆæˆ‘çš„å…´è¶£ã€‚' },
  { no: 2,  k: 'q2',  text: 'ç³»ç»Ÿæ¨èçš„æ—…è¡Œè¡Œç¨‹æ–°é¢–ä¸”æœ‰è¶£ã€‚' },
  { no: 3,  k: 'q3',  text: 'ç³»ç»Ÿæ¨èçš„æ—…æ¸¸æ™¯ç‚¹ç§ç±»ä¸°å¯Œã€‚' },
  { no: 4,  k: 'q4',  text: 'ç³»ç»Ÿæœ‰æ¸…æ™°è§£é‡Šä¸ºä»€ä¹ˆå‘æˆ‘æ¨èè¿™ä¸ªè¡Œç¨‹ã€‚' },
  { no: 5,  k: 'q5',  text: 'æ¨èç³»ç»Ÿçš„ç•Œé¢å¸ƒå±€ç¾è§‚ä¸”åˆç†ã€‚' },
  { no: 6,  k: 'q6',  text: 'ä½¿ç”¨è¯¥ç³»ç»Ÿå¯»æ‰¾æ—…è¡Œè®¡åˆ’éå¸¸æ–¹ä¾¿ã€‚' },
  { no: 7,  k: 'q7',  text: 'æ¨èå†…å®¹æœ‰æ•ˆåœ°å¸®åŠ©æˆ‘åˆ¶å®šäº†ç†æƒ³çš„è¡Œç¨‹ã€‚' },
  { no: 8,  k: 'q8',  text: 'åœ¨ç³»ç»Ÿçš„å¸®åŠ©ä¸‹ï¼Œæˆ‘æ„Ÿå—åˆ°è¢«æ”¯æŒå»å¯»æ‰¾è‡ªå·±å–œæ¬¢çš„å†…å®¹ã€‚' },
  { no: 9,  k: 'q9',  text: 'æ€»ä½“æ¥è¯´ï¼Œæˆ‘å¯¹è¿™ä¸ªç³»ç»Ÿæ„Ÿåˆ°æ»¡æ„ã€‚' },
  { no: 10, k: 'q10', text: 'æˆ‘å¯¹ç³»ç»Ÿçš„æ¨èæ„Ÿåˆ°ä¿¡ä»»ã€‚' },
  { no: 11, k: 'q11', text: 'æˆ‘æœ‰ä¿¡å¿ƒè‡ªå·±ä¼šå–œæ¬¢è¿™ä¸ªè¡Œç¨‹ã€‚' },
  { no: 12, k: 'q12', text: 'æˆ‘æ„¿æ„å†æ¬¡ä½¿ç”¨è¿™ä¸ªæ¨èç³»ç»Ÿã€‚' },
  { no: 13, k: 'q13', text: 'æˆ‘æ„¿æ„å‘æœ‹å‹æ¨èè¿™ä¸ªç³»ç»Ÿã€‚' },
  { no: 14, k: 'q14', text: 'å¦‚æœæœ‰æœºä¼šï¼Œæˆ‘æ„¿æ„é¢„è®¢ç³»ç»Ÿæ¨èçš„è¿™è¶Ÿæ—…è¡Œã€‚' },
],

                    // åç«¯APIé…ç½®
                    backendUrl: 'https://travel-assistant-backend-wbqy.onrender.com/api',
                    
                    // è¡¨å•æ•°æ®ï¼ˆå®Œå…¨æŒ‰ç…§è¦æ±‚çš„å­—æ®µï¼‰
                    formData: {
                        days: 3,
                        spontaneity: 0.5,
                        novelty: 0.7,
                        hedonic: 0.3,
                        tired: 0.6,
                        anxious: 0.4
                    },
                    
                    // äººæ ¼æ•°æ®
                    personality: {
                        openness: null,
                        conscientiousness: null,
                        extraversion: null,
                        agreeableness: null,
                        neuroticism: null
                    },
                    
                    // çŠ¶æ€ç®¡ç†
                    isGenerating: false,
                    isLoading: false,
                    itineraryData: null,
                    apiError: null,
                    historyData: null,
                    dayIndex: [],

                    // èŠå¤©åŠŸèƒ½
                    chatMessages: [
                        {
                            id: 1,
                            sender: 'ai',
                            message: 'ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„æ—…è¡ŒåŠ©æ‰‹ï¼'
                        }
                    ],
                    chatInput: '',
                    isTyping: false,
                    surveySubmitting: false,

survey: {
  // 14 questions, each should be 1..5. Use null to force user choose.
  q1: null,
  q2: null,
  q3: null,
  q4: null,
  q5: null,
  q6: null,
  q7: null,
  q8: null,
  q9: null,
  q10: null,
  q11: null,
  q12: null,
  q13: null,
  q14: null
},

itineraryId: null,


                    // ===== Session control =====
session: 'bfi10', // é»˜è®¤å…ˆè¿›æµ‹è¯•é¡µï¼›å¦‚æœæœ¬åœ°æœ‰ç¼“å­˜ä¼šåœ¨ created() é‡Œåˆ‡åˆ° main

// ===== BFI-10 Test State =====
bfi10: {
  answers: Array(10).fill(3),    // 1..5ï¼Œé»˜è®¤ä¸­ç«‹3
  touched: Array(10).fill(false),// æ˜¯å¦â€œåŠ¨è¿‡â€è¯¥æ»‘æ†
  items: [
    { id: 1,  text: 'æˆ‘æ˜¯ä¸€ä¸ªæ¯”è¾ƒå†…å‘ã€å«è“„çš„äºº', reverse: true },
    { id: 2,  text: 'æˆ‘å®¹æ˜“ä¿¡ä»»ä»–äºº', reverse: false },
    { id: 3,  text: 'æˆ‘æœ‰æ—¶æ¯”è¾ƒæ‡’æ•£ï¼Œç¼ºä¹è¡ŒåŠ¨åŠ›', reverse: true },
    { id: 4,  text: 'æˆ‘é€šå¸¸æ¯”è¾ƒæ”¾æ¾ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°åº”å¯¹å‹åŠ›', reverse: true },
    { id: 5,  text: 'æˆ‘å¯¹è‰ºæœ¯å‡ ä¹æ²¡æœ‰å…´è¶£', reverse: true },
    { id: 6,  text: 'æˆ‘æ˜¯ä¸€ä¸ªå¤–å‘ã€å–„äºç¤¾äº¤çš„äºº', reverse: false },
    { id: 7,  text: 'æˆ‘è®¤ä¸ºè‡ªå·±æ¯”è¾ƒæŒ‘å‰”ï¼Œå®¹æ˜“æ³¨æ„åˆ°ä»–äººçš„ä¸è¶³', reverse: true },
    { id: 8,  text: 'æˆ‘åšäº‹è®¤çœŸã€ç»†è‡´ï¼Œè¿½æ±‚æŠŠäº‹æƒ…åšå¥½', reverse: false },
    { id: 9,  text: 'æˆ‘æ¯”è¾ƒå®¹æ˜“æ„Ÿåˆ°ç´§å¼ æˆ–ç„¦è™‘', reverse: false },
    { id: 10, text: 'æˆ‘è®¤ä¸ºè‡ªå·±å¯Œæœ‰æƒ³è±¡åŠ›ï¼Œæ€ç»´æ´»è·ƒ', reverse: false }
  ]
},

                };
            },
            
              created() {
this.session = 'bfi10';
  },

  computed: {
  bfi10AnsweredCount() {
    return this.bfi10.touched.filter(Boolean).length;
  },
  bfi10Complete() {
    return this.bfi10AnsweredCount === 10;
  }
},


            
methods: {

backToMainAfterSurvey() {
  this.session = 'main';
  this.$nextTick(() => window.scrollTo({ top: 0, behavior: 'smooth' }));
},

startNewTrip() {
  this.session = 'main';
  this.itineraryData = null;
  this.itineraryId = null;

  // é‡ç½®æ–°é—®å·ï¼ˆq1..q14ï¼‰
  this.survey = {
    q1: null, q2: null, q3: null, q4: null, q5: null, q6: null, q7: null,
    q8: null, q9: null, q10: null, q11: null, q12: null, q13: null, q14: null
  };

  this.$nextTick(() => window.scrollTo({ top: 0, behavior: 'smooth' }));
},



backToMainFromSurvey() {
  this.session = 'main';
  this.$nextTick(() => window.scrollTo({ top: 0, behavior: 'smooth' }));
},

resetSurveyAndFillAgain() {
  this.survey = {
    q1: null, q2: null, q3: null, q4: null, q5: null, q6: null, q7: null,
    q8: null, q9: null, q10: null, q11: null, q12: null, q13: null, q14: null
  };
  this.session = 'survey';
  this.$nextTick(() => window.scrollTo({ top: 0, behavior: 'smooth' }));
},


async submitSurvey() {
  // 14é¢˜å¿…ç­”æ ¡éªŒ
  const missing = [];
  for (let i = 1; i <= 14; i++) {
    const k = 'q' + i;
    if (this.survey[k] === null || this.survey[k] === undefined) missing.push(i);
  }
  if (missing.length) {
    alert('Please answer all questions before submitting. Missing: Q' + missing.join(', Q'));
    return;
  }

  try {
    this.surveySubmitting = true;

    const anonId = this.getOrCreateAnonUserId();
console.log('Submitting survey keys:', Object.keys(this.survey));
console.log('Submitting survey payload:', this.survey);

    const payload = {
      itineraryId: this.itineraryId || null,
      userId: anonId,
      survey: { ...this.survey }
    };

    const resp = await axios.post(`${this.backendUrl}/save-survey`, payload, {
      headers: { 'Content-Type': 'application/json' }
    });

    if (resp.data && resp.data.success) {
      this.session = 'survey_done';
      this.$nextTick(() => window.scrollTo({ top: 0, behavior: 'smooth' }));
    } else {
      alert('Submit failed: bad response format');
    }
  } catch (e) {
  console.error('Submit survey failed FULL:', e);
  console.error('Status:', e.response?.status);
  console.error('Data:', e.response?.data);
  alert('Submit failed: ' + (e.response?.data?.message || e.message || 'unknown'));
}
 finally {
    this.surveySubmitting = false;
  }
},



getOrCreateAnonUserId() {
  const key = 'anon_user_id_v1';
  let id = localStorage.getItem(key);
  if (!id) {
    id = 'user_' + Math.random().toString(16).slice(2) + '_' + Date.now();
    localStorage.setItem(key, id);
  }
  return id;
},


            
goToSurvey() {
  if (!this.itineraryData) {
    alert('è¯·å…ˆç”Ÿæˆè¡Œç¨‹ï¼Œå†å¡«å†™é—®å·ã€‚');
    return;
  }
  this.session = 'survey';
  this.$nextTick(() => window.scrollTo({ top: 0, behavior: 'smooth' }));
},

createTemporaryDisplay(content) {
    console.log("åˆ›å»ºä¸´æ—¶æ˜¾ç¤ºçª—å£");
    
    // ç§»é™¤ä¹‹å‰çš„ä¸´æ—¶çª—å£
    const oldWindow = document.getElementById('temp-debug-window');
    if (oldWindow) oldWindow.remove();
    
    // åˆ›å»ºæ–°çª—å£
    const debugWindow = document.createElement('div');
    debugWindow.id = 'temp-debug-window';
    debugWindow.innerHTML = `
        <div style="position: fixed; top: 50px; left: 50px; width: 80%; height: 80%; background: white; border: 5px solid red; z-index: 99999; overflow: auto; padding: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5);">
            <h2 style="color: red; margin-bottom: 20px;">è°ƒè¯•çª—å£ - è¡Œç¨‹å†…å®¹</h2>
            <div id="debug-content">${content}</div>
            <button onclick="document.getElementById('temp-debug-window').remove()" style="position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: red; color: white; border: none; border-radius: 5px; cursor: pointer;">
                å…³é—­
            </button>
        </div>
    `;
    
    document.body.appendChild(debugWindow);
    console.log("ä¸´æ—¶è°ƒè¯•çª—å£å·²åˆ›å»ºï¼Œåº”è¯¥èƒ½çœ‹åˆ°çº¢è‰²è¾¹æ¡†");
},
                createDebugWindow(content) {
    // ç§»é™¤ä¹‹å‰çš„è°ƒè¯•çª—å£
    const oldDebug = document.getElementById('debug-window');
    if (oldDebug) oldDebug.remove();
    
    // åˆ›å»ºæ–°çš„è°ƒè¯•çª—å£
    const debugDiv = document.createElement('div');
    debugDiv.id = 'debug-window';
    debugDiv.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 99999; overflow: auto; padding: 20px;">
            <h2 style="color: red;">è°ƒè¯•çª—å£ - åŸå§‹SSEæ•°æ®</h2>
            <button onclick="document.getElementById('debug-window').remove()" style="position: fixed; top: 20px; right: 20px; padding: 10px 20px; background: red; color: white; border: none; border-radius: 5px;">å…³é—­</button>
            <pre style="background: #f0f0f0; padding: 20px; border-radius: 5px; max-height: 80vh; overflow: auto;">${this.escapeHtml(content)}</pre>
        </div>
    `;
    
    document.body.appendChild(debugDiv);
},

escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
},
    // å¤åˆ¶è¡Œç¨‹å†…å®¹
copyItinerary() {
    if (!this.itineraryData) return;
    
    // ä»HTMLä¸­æå–çº¯æ–‡æœ¬
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = this.itineraryData;
    const plainText = tempDiv.textContent || tempDiv.innerText || '';
    
    navigator.clipboard.writeText(plainText).then(() => {
        alert('è¡Œç¨‹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
    }).catch(err => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        // å¦‚æœå‰ªè´´æ¿APIä¸å¯ç”¨ï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
        const textArea = document.createElement('textarea');
        textArea.value = plainText;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('è¡Œç¨‹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
    });
},

buildDayIndex() {
  this.dayIndex = [];

  const root = document.getElementById('itinerary-display-container');
  if (!root) return;

  // ä½ çš„â€œç¬¬ä¸€å¤©/ç¬¬äºŒå¤©/ç¬¬ä¸‰å¤©â€æ˜¯ h2ï¼Œå¹¶ä¸”è‡ªå¸¦ id
  const h2s = root.querySelectorAll('h2[id]');
  const items = [];

  h2s.forEach(h2 => {
    const title = (h2.textContent || '').trim();
    const m = title.match(/^ç¬¬([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾0-9]+)å¤©/);
    if (m) {
      items.push({
        id: h2.id,
        label: m[0]   // æ˜¾ç¤º â€œç¬¬ä¸€å¤©â€
        // å¦‚æœä½ æƒ³æ˜¾ç¤ºå®Œæ•´æ ‡é¢˜ï¼Œç”¨ï¼šlabel: title
      });
    }
  });

  this.dayIndex = items;
},

scrollToDay(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.scrollIntoView({ behavior: 'smooth', block: 'start' });
},


onBfi10Input(idx) {
  this.$set(this.bfi10.touched, idx, true);
},

calcBfi10RawScores() {
  const a = this.bfi10.answers; // 0..9
  const rev = x => 6 - x;       // 1..5 çš„åå‘è®¡åˆ†ï¼š6-x

  // åå‘é¢˜ï¼š1,3,4,5,7
  const q1  = rev(a[0]);
  const q2  = a[1];
  const q3  = rev(a[2]);
  const q4  = rev(a[3]);
  const q5  = rev(a[4]);
  const q6  = a[5];
  const q7  = rev(a[6]);
  const q8  = a[7];
  const q9  = a[8];
  const q10 = a[9];

  const E = (q1 + q6) / 2;
  const A = (q2 + q7) / 2;
  const C = (q3 + q8) / 2;
  const N = (q4 + q9) / 2;
  const O = (q5 + q10) / 2;

  return { E, A, C, N, O }; // 1..5
},


finishBfi10() {
  if (!this.bfi10Complete) {
    alert('Please complete all 10 questions before finishing.');
    return;
  }

  const raw = this.calcBfi10RawScores();

  // 1..5 -> 0..1 å½’ä¸€åŒ–
  const norm = x => Number(((x - 1) / 4).toFixed(2));

  const scores01 = {
    E: norm(raw.E),
    A: norm(raw.A),
    C: norm(raw.C),
    N: norm(raw.N),
    O: norm(raw.O),
  };

  // å†™å…¥ä½ ç°æœ‰çš„ personality è¾“å…¥æ¡†
  this.personality.openness = scores01.O;
  this.personality.conscientiousness = scores01.C;
  this.personality.extraversion = scores01.E;
  this.personality.agreeableness = scores01.A;
  this.personality.neuroticism = scores01.N;

  // ç¼“å­˜ï¼ˆä¸‹æ¬¡è¿›æ¥ç›´æ¥è·³è¿‡æµ‹è¯•ï¼‰
  localStorage.setItem('bfi10_scores_v1', JSON.stringify(scores01));

  // åˆ‡åˆ°ä¸»é¡µé¢
  this.session = 'main';

  // å¯é€‰ï¼šè·³åˆ° Personality åŒºåŸŸï¼ˆéœ€è¦ç¬¬7æ­¥åŠ idï¼‰
  this.$nextTick(() => {
    const el = document.getElementById('personality-section');
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
},

                // ç”Ÿæˆè¡Œç¨‹ï¼ˆè°ƒç”¨Coze APIï¼‰
                async generateItinerary() {
                    try {
                        this.isGenerating = true;
                        this.isLoading = true;
                        this.itineraryData = null;
                        this.apiError = null;
                        this.historyData = null;

                        // éªŒè¯è¾“å…¥æ•°æ®
                        const validation = this.validateInputData();
                        if (!validation.valid) {
                            alert(validation.message);
                            this.isGenerating = false;
                            this.isLoading = false;
                            return;
                        }

                        // æ·»åŠ ç”Ÿæˆæ¶ˆæ¯åˆ°èŠå¤©
                        this.addChatMessage('AI Assistant', 'æˆ‘æ­£åœ¨åˆ†ææ‚¨çš„åå¥½ï¼Œå¹¶ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–çš„è¡Œç¨‹å®‰æ’â€¦â€¦', 'ai');

                        // å‡†å¤‡APIè¯·æ±‚æ•°æ®
                        const requestData = {
                            days: this.formData.days,
                            e_tired: this.formData.tired,        
                            e_anxious: this.formData.anxious,    
                            e_curious: this.formData.novelty,    
                            u_profile: {
                                b5: [
                                    this.personality.openness,
                                    this.personality.conscientiousness,
                                    this.personality.extraversion,
                                    this.personality.agreeableness,
                                    this.personality.neuroticism
                                ],
                                p: [
                                    this.formData.spontaneity,
                                    this.formData.novelty,
                                    this.formData.hedonic
                                ]
                            }
                        };

                       // è°ƒç”¨åç«¯APIï¼ˆè½¬å‘åˆ°Coze APIï¼‰
const response = await axios.post(`${this.backendUrl}/generate-itinerary`, requestData, {
    headers: { 'Content-Type': 'application/json' }
});
console.log("APIè¿”å›æ•°æ®:", response.data);
this.itineraryId = response.data.itineraryId || null;


// è·å–è¡Œç¨‹å†…å®¹
let itineraryContent = response.data.itinerary.final_itinerary;
console.log("itineraryContentç±»å‹:", typeof itineraryContent, "å†…å®¹é¢„è§ˆ:", itineraryContent.substring(0, 200) + "...");

// è§£æSSEæ ¼å¼çš„æ•°æ®æµ
if (typeof itineraryContent === 'string') {
    try {
        console.log("å¼€å§‹è§£æSSEæ•°æ®æµï¼Œæ€»é•¿åº¦:", itineraryContent.length);
        
        // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾æ‰€æœ‰ content å­—æ®µ
        let markdownContent = null;
        const regex = /"content":"(.*?)"/g;
        const matches = [];
        let match;
        
        while ((match = regex.exec(itineraryContent)) !== null) {
            if (match[1] && match[1].trim() !== '' && match[1] !== '{}') {
                matches.push(match[1]);
            }
        }
        
        console.log("æ‰¾åˆ°", matches.length, "ä¸ªcontentå­—æ®µ");
        
        // å–æœ€åä¸€ä¸ªéç©ºçš„ contentï¼ˆé€šå¸¸æ˜¯æœ€ç»ˆç»“æœï¼‰
        if (matches.length > 0) {
            // è·å–æœ€åä¸€ä¸ªcontentï¼ˆé€šå¸¸æ˜¯æœ€å®Œæ•´çš„è¡Œç¨‹å†…å®¹ï¼‰
            markdownContent = matches[matches.length - 1];
            console.log("ä½¿ç”¨æœ€åä¸€ä¸ªcontentï¼Œé•¿åº¦:", markdownContent.length);
            
            // å¤„ç†è½¬ä¹‰å­—ç¬¦
            markdownContent = markdownContent
                .replace(/\\u0026/g, '&') 
                .replace(/\\n/g, '\n')
                .replace(/\\"/g, '"')
                .replace(/\\'/g, "'")
                .replace(/\\\\/g, '\\');
            
            console.log("å¤„ç†åçš„å†…å®¹é¢„è§ˆ:", markdownContent.substring(0, 200) + "...");
        } else {
            console.warn("æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„contentå­—æ®µ");
        }
        
        // å¦‚æœæˆåŠŸæå–åˆ°å†…å®¹
        if (markdownContent) {
            // å°†Markdownè½¬æ¢ä¸ºHTML
            this.itineraryData = marked.parse(markdownContent);
            console.log("è¡Œç¨‹æ•°æ®å·²è®¾ç½®ï¼Œé•¿åº¦:", this.itineraryData.length);
            console.log(this.itineraryData)
            
            // ç¡®ä¿Vueæ›´æ–°è§†å›¾
            this.$nextTick(() => {
    console.log("Vueè§†å›¾å·²æ›´æ–°");
    
    // æµ‹è¯•æ˜¯å¦çœŸçš„æ¸²æŸ“åˆ°äº†DOM
    const testElement = document.getElementById('itinerary-display-container');
    if (testElement) {
        console.log("æ‰¾åˆ°è¡Œç¨‹æ˜¾ç¤ºå…ƒç´ ");
        console.log("å…ƒç´ å†…å®¹é•¿åº¦:", testElement.innerHTML.length);
        
        // å¼ºåˆ¶æ˜¾ç¤ºä»¥ç¡®ä¿å¯è§
        testElement.style.cssText = `
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            height: auto !important;
            color: #333 !important;
            background: transparent !important;
            position: relative !important;
            z-index: 100 !important;
        `;
        
    } else {
        console.log("æœªæ‰¾åˆ°è¡Œç¨‹æ˜¾ç¤ºå…ƒç´ ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥HTMLç»“æ„");
    }
    this.buildDayIndex();

});
            
            // åˆ›å»ºè°ƒè¯•çª—å£æ˜¾ç¤ºåŸå§‹æ•°æ®
            //this.createDebugWindow(this.itineraryData);
            
        }
    } catch (error) {
        console.error("è§£æè¡Œç¨‹å†…å®¹å¤±è´¥:", error);
        this.apiError = "è§£æè¡Œç¨‹å†…å®¹å¤±è´¥: " + error.message;
    }
} else {
    console.log("itineraryContentæ˜¯å¯¹è±¡ç±»å‹:", itineraryContent);
    if (itineraryContent && itineraryContent.content) {
        this.itineraryData = marked.parse(itineraryContent.content);
    } else {
        this.apiError = "è¡Œç¨‹æ•°æ®æ ¼å¼é”™è¯¯";
    }
}
this.isLoading = false;

                        // æ·»åŠ æˆåŠŸæ¶ˆæ¯åˆ°èŠå¤©
                        this.addChatMessage('AI Assistant', 'å·²æˆåŠŸä¸ºä½ ç”Ÿæˆä¸ªæ€§åŒ–è¡Œç¨‹ï¼ä½ å¯ä»¥åœ¨ä¸Šæ–¹æŸ¥çœ‹ï¼Œå¹¶è¯¢é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚', 'ai');

                    } catch (error) {
                        console.error('ç”Ÿæˆè¡Œç¨‹é”™è¯¯:', error);

                        // åˆ¤æ–­é”™è¯¯ç±»å‹
                        if (error.response) {
                            // åç«¯è¿”å›çš„é”™è¯¯
                            if (error.response.status === 400) {
                                // ä¾‹å¦‚æ•°æ®éªŒè¯é”™è¯¯
                                this.apiError = `è¾“å…¥é”™è¯¯ï¼š${error.response.data.message}`;
                            } else {
                                // å…¶ä»– API é”™è¯¯
                                this.apiError = `API é”™è¯¯ï¼š${error.response.data.message || 'æ— æ³•ç”Ÿæˆè¡Œç¨‹'}`;
                            }
                        } else if (error.request) {
                            // ç½‘ç»œé”™è¯¯
                            this.apiError = 'ç½‘ç»œé”™è¯¯ï¼šæ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
                        } else {
                            // å…¶ä»–é”™è¯¯
                            this.apiError = `æœªçŸ¥é”™è¯¯ï¼š${error.message}`;
                        }

                        this.isLoading = false;
                    } finally {
                        this.isGenerating = false;
                        this.isLoading = false;
                    }
                },

                // éªŒè¯è¾“å…¥æ•°æ®
                validateInputData() {
                    // éªŒè¯å¤©æ•°
                    if (!this.formData.days || this.formData.days < 1 || this.formData.days > 7) {
                        return {
                            valid: false,
                            message: 'è¯·è¾“å…¥ 1 è‡³ 7 å¤©ä¹‹é—´çš„æœ‰æ•ˆæ—…è¡Œå¤©æ•°ã€‚'
                        };
                    }

                    // éªŒè¯æ»‘æ†å€¼
                    const sliderFields = ['spontaneity', 'novelty', 'hedonic', 'tired', 'anxious'];
                    for (const field of sliderFields) {
                        if (this.formData[field] === undefined || this.formData[field] < 0 || this.formData[field] > 1) {
                            return {
                                valid: false,
                                message: 'æ‰€æœ‰æ»‘å—çš„æ•°å€¼å¿…é¡»ä»‹äº 0.0 åˆ° 1.0 ä¹‹é—´ã€‚'
                            };
                        }
                    }

                    // éªŒè¯äººæ ¼æ•°æ®ï¼ˆå¦‚æœå¡«å†™äº†çš„è¯ï¼‰
                    const personalityFields = ['openness', 'conscientiousness', 'extraversion', 'agreeableness', 'neuroticism'];
                    for (const field of personalityFields) {
                        if (this.personality[field] !== null && (isNaN(this.personality[field]) || this.personality[field] < 0 || this.personality[field] > 1)) {
                            return {
                                valid: false,
                                message: 'äººæ ¼ç‰¹è´¨æµ‹è¯•ç»“æœå¿…é¡»åœ¨ 0.0 åˆ° 1.0 ä¹‹é—´ã€‚'
                            };
                        }
                    }

                    return { valid: true };
                },

                // ä¿å­˜ç”¨æˆ·é…ç½®
                async saveProfile() {
                    try {
                        const profileData = {
                            formData: this.formData,
                            personality: this.personality,
                            createdAt: new Date()
                        };

                        await axios.post(`${this.backendUrl}/save-profile`, profileData, {
                            headers: { 'Content-Type': 'application/json' }
                        });

                        alert('Profile saved successfully!');
                        this.addChatMessage('AI Assistant', 'Your preferences have been saved successfully!', 'ai');

                    } catch (error) {
                        console.error('Error saving profile:', error);
                        alert('Failed to save profile: ' + (error.response?.data?.message || 'Unknown error'));
                    }
                },

                // è·å–å†å²è¡Œç¨‹
                async getHistory() {
                    try {
                        this.isLoading = true;
                        const response = await axios.get(`${this.backendUrl}/itinerary-history`);
                        this.historyData = response.data;
                        this.itineraryData = null;
                        this.isLoading = false;
                    } catch (error) {
                        console.error('Error fetching history:', error);
                        this.apiError = 'Failed to fetch itinerary history';
                        this.isLoading = false;
                    }
                },

                // åŠ è½½å†å²è¡Œç¨‹
                loadHistoryItem(item) {
                    this.itineraryData = item.final_itinerary; // åŠ è½½å†å²è¡Œç¨‹çš„å…·ä½“å†…å®¹
                    this.historyData = null;
                    this.addChatMessage('AI Assistant', 'å·²åŠ è½½æ‚¨çš„è¿‡å¾€è¡Œç¨‹ã€‚', 'ai');
                },

                // èŠå¤©åŠŸèƒ½
async sendChatMessage() {
    const message = this.chatInput.trim();
    if (!message) return;
    if (!this.itineraryData) {
        this.addChatMessage('AI Assistant', 'è¯·å…ˆç”Ÿæˆè¡Œç¨‹ï¼Œå†è¿›è¡Œæé—®å“¦ï½', 'ai');
        return;
    }

    this.addChatMessage('You', message, 'user');
    this.chatInput = '';

    this.isTyping = true;

    try {
        // ä»HTMLä¸­æå–çº¯æ–‡æœ¬å†…å®¹
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = this.itineraryData;
        const plainText = tempDiv.textContent || tempDiv.innerText || '';
        
        // å¦‚æœçº¯æ–‡æœ¬è¿‡é•¿ï¼Œæˆªå–å‰2000ä¸ªå­—ç¬¦ï¼ˆé˜²æ­¢è¶…å‡ºtokené™åˆ¶ï¼‰
        const trimmedText = plainText.length > 2000 ? 
            plainText.substring(0, 2000) + '...' : 
            plainText;

        console.log("å‘é€åˆ°èŠå¤©APIçš„è¡Œç¨‹æ–‡æœ¬ï¼ˆå‰200å­—ç¬¦ï¼‰:", trimmedText.substring(0, 200));

        const response = await axios.post(`${this.backendUrl}/chat`, {
            message: message,
            itineraryText: trimmedText,
            conversationId: this.conversationId,
            userId: 'user_' + Date.now()
        }, {
            headers: { 'Content-Type': 'application/json' }
        });

        this.isTyping = false;
        
        if (response.data.success && response.data.reply) {
            this.addChatMessage('AI Assistant', response.data.reply, 'ai');
            this.conversationId = response.data.conversation_id;
        } else {
            this.addChatMessage('AI Assistant', 'å›å¤ä¼¼ä¹æ˜¯ç©ºç™½çš„ï¼Œè¯·å†è¯•ä¸€æ¬¡ã€‚', 'ai');
        }

    } catch (error) {
        console.error('èŠå¤©é”™è¯¯:', error);
        this.isTyping = false;
        
        let errorMessage = 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ã€‚è¯·å†è¯•ä¸€æ¬¡ã€‚';
        if (error.response) {
            errorMessage = `API Error: ${error.response.data?.message || 'Unknown error'}`;
        } else if (error.request) {
            errorMessage = 'ç½‘ç»œé”™è¯¯ã€‚è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ã€‚';
        }
        
        this.addChatMessage('AI Assistant', errorMessage, 'ai');
    }
}
,

                handleChatKeyPress(e) {
                    if (e.key === 'Enter') {
                        this.sendChatMessage();
                    }
                },

                addChatMessage(sender, message, type) {
                    const formattedContent = message.replace(/\n/g, '<br>');
                    this.chatMessages.push({
                        id: Date.now(),
                        sender: type,
                        message: formattedContent
                    });
                    
                    // æ»šåŠ¨åˆ°åº•éƒ¨
                    setTimeout(() => {
                        const chatContainer = document.querySelector('#chatMessages');
                        if (chatContainer) {
                            chatContainer.scrollTop = chatContainer.scrollHeight;
                        }
                    }, 100);
                },

                // è¾…åŠ©å‡½æ•°
                getTypeColor(type) {
                    const typeColors = {
                        adventurous: 'bg-green-100 text-green-700',
                        cultural: 'bg-purple-100 text-purple-700',
                        relaxing: 'bg-blue-100 text-blue-700',
                        social: 'bg-pink-100 text-pink-700',
                        structured: 'bg-yellow-100 text-yellow-700',
                        flexible: 'bg-indigo-100 text-indigo-700',
                        balanced: 'bg-gray-100 text-gray-700'
                    };
                    return typeColors[type.toLowerCase()] || 'bg-gray-100 text-gray-700';
                },

                getActivityTime(activityNumber) {
                    const times = ['8:00 AM', '10:30 AM', '1:00 PM', '3:30 PM', '6:00 PM'];
                    return times[activityNumber - 1] || 'TBA';
                }
            }
        });
    </script>
</body>
</html>
